---
import MainLayout from "../../layouts/MainLayout.astro";
import { getCollection, getEntry } from "astro:content";
import type { CollectionEntry } from "astro:content";
import ArticleCard from "../../components/ArticleCard.astro";
import SearchForm from "../../components/SearchForm.astro";
import Pagination from "../../components/Pagination.astro";
import {ARTICLES_PER_PAGE} from '../../constants'

const allBlogArticles: CollectionEntry<'blog'>[] = (await getCollection('blog')).sort((a,b) =>b.data.pubDate.valueOf() - a.data.pubDate.valueOf() );
// console.log(allBlogArticles[0]);
const currentPage : number | null = +Astro.url.searchParams.get('page')! || 1
const totalPages:number = Math.ceil(allBlogArticles.length/ARTICLES_PER_PAGE)
// console.log(totalPages)

const articlesForPage : CollectionEntry<'blog'>[] = allBlogArticles.slice((currentPage-1)* ARTICLES_PER_PAGE, ARTICLES_PER_PAGE*currentPage )
---
<MainLayout>
 <div class="my-2">
        <h1 class="text-xl font-bold">Toate Articolele</h1>
</div>
<SearchForm/>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2">
       {articlesForPage.map((article)=>( 
      <ArticleCard article={article}/>
      ))}
        </div>
        <!-- Pagination -->
         <Pagination
           currentPage={currentPage} 
           totalPages={totalPages} 
           disablePrevious={currentPage === 1} 
           disableNext={currentPage === totalPages} />
        
</MainLayout>